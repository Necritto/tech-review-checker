# **Этапы конвейера рендеринга в браузере**

#### **1. Layout (Reflow)**

**Что делает:**

- Вычисляет точные размеры и положение каждого элемента
- Строит **дерево макета** (Layout Tree) на основе CSSOM и DOM

**Ключевые аспекты:**

- Триггерится изменениями геометрии (width, height, position)
- Каскадный эффект: изменение одного элемента → пересчёт родительских/дочерних элементов
- **Оптимизация:**
  - `transform`/`opacity` не вызывают layout
  - Использование `contain: layout` для изоляции изменений

#### **2. Painting (Rasterization)**

**Что делает:**

- Преобразует элементы в пиксели (растеризация)
- Создает **список отрисовки** (Paint Records)

**Ключевые аспекты:**

- Включает:
  - Заполнение цветом (fill)
  - Текст и границы (stroke)
  - Тени и градиенты
- **Оптимизация:**
  - `will-change: paint` для выделения слоя
  - Избегание сложных box-shadows

#### **3. Compositing**

**Что делает:**

- Объединяет слои (layers) в конечное изображение
- Работает с **графическим процессором (GPU)**

**Ключевые аспекты:**

- Отдельные слои для:
  - Элементов с `transform: translateZ(0)`
  - `<video>`, `<canvas>`
- **Оптимизация:**
  - `will-change: transform` для GPU-ускорения
  - Избегание "слоёвого взрыва" (слишком многих слоёв)

---

### **Сравнительная таблица**

| Этап            | Зависит от    | Триггеры                | Оптимизации              |
| --------------- | ------------- | ----------------------- | ------------------------ |
| **Layout**      | DOM + CSSOM   | Изменения геометрии     | `contain: layout`        |
| **Painting**    | Layout Tree   | Изменения внешнего вида | `will-change: paint`     |
| **Compositing** | Слои (Layers) | transform/opacity       | `will-change: transform` |

---

### **Примеры влияния на производительность**

**Плохо:**

```javascript
element.style.width = "100px"; // Layout → Paint → Composite
element.style.height = "200px"; // Ещё один Layout → Paint → Composite
```

**Хорошо:**

```javascript
element.style.transform = "scale(1.5)"; // Только Composite
```
