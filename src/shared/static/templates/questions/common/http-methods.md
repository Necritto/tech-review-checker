# **Ключевые различия**

| Метод     | Идемпотентность | Назначение                               | Тело запроса                | Пример использования                               |
| --------- | --------------- | ---------------------------------------- | --------------------------- | -------------------------------------------------- |
| **POST**  | Нет             | Создание ресурса или выполнение действия | Полное представление данных | `POST /users` (создание пользователя)              |
| **PUT**   | Да              | Полная замена ресурса                    | Полное представление данных | `PUT /users/123` (замена всех данных пользователя) |
| **PATCH** | Нет\*           | Частичное обновление ресурса             | Только изменяемые поля      | `PATCH /users/123` (обновление email)              |

> \*PATCH может быть идемпотентным при правильной реализации

---

## **Технические детали**

### **POST**

- **Семантика:** "Обработай эти данные"
- **Статус ответа:**
  - `201 Created` (при успешном создании)
  - `200 OK` (для действий)
- **Пример:**

    ```http
    POST /articles HTTP/1.1
    Content-Type: application/json
    {"title": "Новая статья"}
    ```

### **PUT**

- **Семантика:** "Сохрани этот ресурс по указанному URI"
- **Требования:**
  - Клиент должен знать полный URI
  - Сервер полностью заменяет ресурс
- **Пример:**

    ```http
    PUT /users/123 HTTP/1.1
    Content-Type: application/json
    {"name": "Иван", "email": "ivan@example.com"}
    ```

### **PATCH**

- **Семантика:** "Примени эти изменения к ресурсу"
- **Форматы тела:**
  - JSON Patch (RFC 6902):

    ```json
    [{ "op": "replace", "path": "/email", "value": "new@example.com" }]
    ```

  - JSON Merge Patch (RFC 7386)
- **Пример:**

    ```http
    PATCH /users/123 HTTP/1.1
    Content-Type: application/json-patch+json
    [{"op": "replace", "path": "/email", "value": "new@email.com"}]
    ```

---

## **Практические рекомендации**

1. **Безопасность:**
    - PUT/PATCH требуют проверки ETag для предотвращения lost updates
2. **Идемпотентность:**
    - Генерировать клиентские ID для POST-запросов
3. **Веб-кэширование:**
    - PUT-ответы могут кэшироваться
    - PATCH-ответы обычно не кэшируются

---

## **Edge-кейсы**

1. **PATCH для несуществующего ресурса:**
    - Должен ли сервер создавать ресурс? (зависит от API-дизайна)
2. **PUT с частичными данными:**
    - Считается антипаттерном (может обнулить неуказанные поля)
3. **Множественные PATCH:**
    - Как гарантировать порядок применения изменений?
