# ❓ Как обмениваться данными между вкладками браузера на разных доменах?

---

## Ограничения

- По умолчанию браузеры запрещают доступ к данным между вкладками с разными origin из-за политики Same-Origin Policy (SOP).  
- Это значит, что прямой доступ к `localStorage`, `BroadcastChannel` или `SharedWorker` между разными доменами невозможен.

---

## Возможные способы обмена

### 1. `window.postMessage` через общие окна или iframe

- Вкладки или окна могут обмениваться сообщениями через `postMessage`, если у них есть доступ к объекту окна друг друга (например, родитель и iframe или окно, открытое через `window.open`).

- Для вкладок с разными доменами:

  - Одна вкладка открывает другую через `window.open`.

  - Используется `postMessage` для безопасной передачи сообщений.

- Приёмник должен проверять источник (`event.origin`) для безопасности.

---

#### Пример

```js
// Вкладка-отправитель
const otherWindow = window.open('https://other-domain.com');
otherWindow.postMessage({ data: 'Hello' }, 'https://other-domain.com');

// Вкладка-получатель
window.addEventListener('message', event => {
  if (event.origin !== 'https://trusted-origin.com') return; // проверка безопасности
  console.log('Получено сообщение:', event.data);
});
```

---

### 2. Использование серверного посредника

- Вкладки разных доменов общаются через сервер API.

- Обе вкладки отправляют и получают данные с сервера (например, через WebSocket или периодические запросы).

- Это гарантирует контроль безопасности и масштабируемость.

---

### 3. Документирование политики CORS

- Для некоторых запросов можно настроить серверы, разрешающие кросс-доменные запросы (CORS), чтобы вкладки могли обмениваться данными через AJAX.

- Это не позволяет напрямую обмениваться состоянием вкладок, а лишь взаимодействовать через сервер.

---

## Итог

- Прямой обмен данными между вкладками разных доменов невозможен из-за политики безопасности браузеров.

- Основные решения — использовать `postMessage` между окнами с явной связью (например, родитель и iframe), либо использовать сервер в роли посредника для синхронизации данных.

- Всегда необходимо проверять источник сообщений для защиты от атак.

---
