# ❓ Разница между микрозадачами (microtasks) и макрозадачами (macrotasks) в Event Loop

---

## Определения

- **Микрозадачи (Microtasks):**  
  Очередь задач с высоким приоритетом, выполняются сразу после текущего стека вызовов и до следующей макрозадачи.

- **Макрозадачи (Macrotasks):**  
  Основная очередь задач, куда помещаются такие события как таймеры, ввод пользователя, сетевые запросы и др.

---

## Примеры

| Тип задачи        | Примеры                        |
|-------------------|-------------------------------|
| Микротаски        | Promise `.then()`, `MutationObserver`, `queueMicrotask` |
| Макротаски        | `setTimeout`, `setInterval`, события DOM, `setImmediate` (Node.js) |

---

## Порядок выполнения

1. Выполняется весь синхронный код (call stack).

2. Выполняются все микротаски из очереди microtask queue.

3. Выполняется одна макротаска из task queue.

4. Переход к шагу 2.

---

## Важные особенности

- Микротаски выполняются **перед** любой макротаской, что обеспечивает быстрый отклик (например, обработка результатов промисов).

- Если микротаски создают новые микротаски — они выполняются сразу же, перед продолжением к макротаскам.

- Бесконтрольное создание микротасков может привести к "зависанию" цикла, блокируя макротаски.

---

## Иллюстрация

```js
console.log('script start');

setTimeout(() => {
  console.log('setTimeout');
}, 0);

Promise.resolve().then(() => {
  console.log('promise1');
}).then(() => {
  console.log('promise2');
});

console.log('script end');
```

**Вывод:**

```text
script start  
script end  
promise1  
promise2  
setTimeout
```

---

## Итог

- Микротаски — это мелкие задачи, выполняемые сразу после текущего кода и перед макротасками.

- Макротаски — более крупные события, выполняемые после всех микротасков.

- Понимание разницы критично для правильной работы с асинхронностью в JS.

---
