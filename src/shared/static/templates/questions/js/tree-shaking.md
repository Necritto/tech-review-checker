# ❓ Как работает tree shaking на основе дерева зависимостей?

---

## Определение

- Tree shaking — это процесс удаления неиспользуемого кода из итогового бандла на основе анализа дерева зависимостей и статического анализа импортов/экспортов.

---

## Принцип работы

1. **Статический анализ модулей:**  
   - Сборщик (например, Webpack, Rollup) парсит все модули и строит дерево зависимостей.  
   - Определяет, какие экспорты реально используются в коде (imported & referenced).

2. **Отслеживание используемых сущностей:**  
   - Начинается обход с точки входа (entry point).  
   - Все импорты и вызовы функций, ссылки на переменные фиксируются как "живые".

3. **Удаление мертвого кода:**  
   - Экспорты и функции, на которые нет ссылок в итоговом коде, считаются "мертвыми".  
   - Они исключаются из бандла.

---

## Важные моменты

- **ES Modules:**  
  - Tree shaking работает только с ESM, так как их синтаксис позволяет статический анализ.  
  - CommonJS (require/exports) — динамический, затрудняет анализ и ограничивает tree shaking.

- **Side effects:**  
  - Если модуль или файл содержит побочные эффекты, сборщик может не удалить его полностью.  
  - Указывается в package.json через поле `"sideEffects": false` для оптимизации.

- **Динамические импорты:**  
  - Код, загружаемый через `import()`, анализируется отдельно, влияет на чанки.

---

## Пример

```js
// utils.js
export function usedFunc() { return 1; }
export function unusedFunc() { return 2; }

// main.js
import { usedFunc } from './utils.js';
console.log(usedFunc());
```

- Tree shaking удалит `unusedFunc` из финального бандла.

---

## Итог

Tree shaking — это оптимизация, основанная на анализе дерева зависимостей и статическом отслеживании используемых экспортов, позволяющая уменьшить размер бандла, удаляя неиспользуемый код.

---
