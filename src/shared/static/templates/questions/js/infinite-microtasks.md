# ❓ Что произойдет при бесконечном добавлении микротасков?

---

## Поведение

- Микротаски выполняются сразу после завершения текущего call stack и **перед** выполнением макротасков.

- Если микротаски в процессе выполнения добавляют новые микротаски, event loop продолжит их выполнять, не переходя к макротаскам.

- При бесконечном добавлении микротасков цикл никогда не дойдет до макротасков и не обработает пользовательские события, таймеры и рендеринг.

---

## Последствия

- **Блокировка event loop:**  
  UI перестанет реагировать на действия пользователя.

- **Заморозка интерфейса:**  
  Приложение "зависнет", т.к. браузер не сможет отрисовать обновления.

- **Высокая нагрузка на CPU:**  
  Беспрерывное выполнение микротасков без пауз.

---

## Пример

```js
function infiniteMicrotasks() {
  Promise.resolve().then(() => {
    console.log('Microtask');
    infiniteMicrotasks(); // добавляет микротаск бесконечно
  });
}

infiniteMicrotasks();
```

Этот код вызовет бесконечный цикл микротасков, блокирующий event loop.

---

## Защита и рекомендации

- Избегайте добавления микротасков внутри микротасков без ограничения.

- Используйте макротаски (`setTimeout`) для разбиения тяжелых операций.

- Следите за количеством микротасков в цепочке Promise.

- В браузерах часто встроена защита, прерывающая скрипты, работающие слишком долго.

---

## Итог

- Бесконечное добавление микротасков блокирует event loop, замораживая UI и останавливая обработку событий.

- Необходимо контролировать создание микротасков и при необходимости использовать макротаски для долгих или повторяющихся задач.

---
