# ❓ Какие ограничения есть у tree shaking в CommonJS?

---

## Особенности CommonJS

- CommonJS использует динамические конструкции:  
  - `require()` вызывается во время выполнения, что усложняет статический анализ.  
  - Экспорт реализуется через объект `module.exports` или `exports`, часто изменяемый динамически.

---

## Ограничения tree shaking в CommonJS

1. **Отсутствие статической структуры:**  
   - Импорты и экспорты неявные, динамические, невозможно однозначно определить, что именно импортируется или экспортируется.  
   - Нельзя точно определить, какие части модуля используются.

2. **Динамические выражения:**  
   - `require(someVariable)` не позволяет сборщику заранее определить зависимости.

3. **Объектный экспорт:**  
   - Экспорт может быть изменён в рантайме (например, добавление свойств к `exports`), что препятствует удалению неиспользуемого кода.

4. **Отсутствие поддержки tree shaking в большинстве сборщиков для CommonJS:**  
   - Webpack и Rollup поддерживают tree shaking только для ES Modules.

---

## Последствия

- Весь модуль CommonJS, даже с частично неиспользуемым кодом, включается полностью в бандл.  
- Увеличение размера итогового бандла, невозможность оптимальной очистки.

---

## Как обойти ограничения

- Использовать ES Modules вместо CommonJS там, где это возможно.  
- Конвертировать CommonJS модули с помощью Babel или специальных плагинов.  
- В некоторых случаях вручную разделять модули для лучшей оптимизации.

---

## Итог

Tree shaking практически не работает с CommonJS из-за динамичности `require` и `module.exports`. Это ограничение связано с невозможностью статического анализа импортов и экспортов.

---
