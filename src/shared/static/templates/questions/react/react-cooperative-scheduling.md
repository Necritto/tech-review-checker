# üß† –ß—Ç–æ —Ç–∞–∫–æ–µ cooperative scheduling –∏ –∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ Fiber

---

## üóÇÔ∏è –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Cooperative scheduling** (–∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **–º–µ–ª–∫–∏–µ –∑–∞–¥–∞—á–∏**, –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å **–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ –ø—Ä–µ—Ä–≤–∞–Ω–æ**, —á—Ç–æ–±—ã –æ—Ç–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª–µ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–µ.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç **preemptive scheduling** (–∫–∞–∫ –≤ –û–°), –∑–¥–µ—Å—å **—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫/–¥–≤–∏–∂–æ–∫ —Å–∞–º —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ "—É—Å—Ç—É–ø–∏—Ç—å" –∫–æ–Ω—Ç—Ä–æ–ª—å**, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥.

---

## üß¨ –ö–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å Fiber

React Fiber —Ä–µ–∞–ª–∏–∑—É–µ—Ç cooperative scheduling —Å –ø–æ–º–æ—â—å—é:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ –Ω–∞ —à–∞–≥–∏ (units of work)**
2. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ –∏—Å—Ç–µ–∫–ª–æ –ª–∏ –≤—Ä–µ–º—è (deadline)**
3. **–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ç–æ–∫ (main thread)**

### üß± –ü—Ä–∏–º–µ—Ä

–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–æ–ª—å—à–æ–≥–æ —Å–ø–∏—Å–∫–∞:

```tsx
const items = Array(10000).fill(0).map((_, i) => <Item key={i} />);
return <div>{items}</div>;
```

–í —Å—Ç–∞—Ä–æ–π –º–æ–¥–µ–ª–∏ —ç—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

–° Fiber:

* –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ `Item` —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∫—É—Å–∫–∏.
* –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫—É—Å–∫–∞ React –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: **"–ï—Å—Ç—å –ª–∏ –≤—Ä–µ–º—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å?"**
* –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî React **—É—Å—Ç—É–ø–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**, –¥–∞–≤–∞—è –±—Ä–∞—É–∑–µ—Ä—É –≤—Ä–µ–º—è –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Ñ—Ä–µ–π–º, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –∏ —Ç.–¥.

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º

```ts
while (hasWork && shouldYield() === false) {
  performUnitOfWork(nextFiber);
}
```

* `shouldYield()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é [`scheduler`](https://github.com/facebook/react/tree/main/packages/scheduler)
* React –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `MessageChannel` –∏–ª–∏ `requestIdleCallback`, —á—Ç–æ–±—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

## ‚è≥ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ startTransition

React –≤–≤–æ–¥–∏—Ç **—É—Ä–æ–≤–Ω–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤**:

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
* –ê–Ω–∏–º–∞—Ü–∏–∏
* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å—Ä–µ–¥–Ω–∏–π)
* –ë—ç–∫–≥—Ä–∞—É–Ω–¥–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∏–∑–∫–∏–π)

–° `startTransition` –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É:

```tsx
startTransition(() => {
  setSearchQuery(input);
});
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:

* –ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
* –ü–æ—Ç–æ–º –æ–±–Ω–æ–≤–∏—Ç—å DOM (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

---

## üìå –ò—Ç–æ–≥–æ

* **Cooperative scheduling** –≤ Fiber –ø–æ–∑–≤–æ–ª—è–µ—Ç React —Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞–≤–Ω–æ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
* React –º–æ–∂–µ—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–±–æ—Ç—É, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –∑–∞–¥–∞—á–∏ —Å —É—á–µ—Ç–æ–º –∏—Ö **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞**
* –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –¥–ª—è **Concurrent Features**, —Ç–∞–∫–∏—Ö –∫–∞–∫ `Suspense`, `startTransition`, `useDeferredValue`

---
