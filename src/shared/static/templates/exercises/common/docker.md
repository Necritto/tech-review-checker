&nbsp;
&nbsp;
&nbsp;

```dockerfile
# У тебя есть React-приложение, сборка которого настроена через Webpack (npm run build создаёт папку dist/ с финальным # бандлом).

# 1. Что именно пойдёт не так, если запустить этот контейнер в продакшене?
# 2. Почему использование npm start здесь не подходит для продакшн-окружения?
# 3. Что происходит с портом 3000 в этом Dockerfile и почему это может вызвать проблемы?
# 4. Как лучше построить Dockerfile для production React-приложения на Webpack?
# 5. Нужно ли копировать весь исходный код в продакшн-образ? Почему?

FROM node:latest

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
```

&nbsp;
&nbsp;
&nbsp;

---

&nbsp;
&nbsp;
&nbsp;

| №   | Ошибка                                                                                              | Объяснение                                                                                               |
| --- | --------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| 1   | Запуск `npm start` запускает dev-сервер (Webpack Dev Server), а не production-бандл                 | Dev-сервер не предназначен для продакшена: не оптимизирован, медленный, с HMR и watch mode               |
| 2   | Копируется весь исходный код (включая node_modules, src, конфиги) в финальный образ                 | Увеличивает размер образа, содержит ненужные файлы, потенциально раскрывает исходники                    |
| 3   | Отсутствует статический сервер для отдачи production-бандла                                         | Webpack build создаёт только статические файлы, но без сервера они не будут доступны                     |
| 4   | EXPOSE 3000 не соответствует серверу, если он запускается на другом порту (например, 8080 или 5000) | Несогласованность портов ведёт к проблемам с сетью и прокси                                              |
| 5   | Нет `.dockerignore`, из-за чего копируются лишние файлы и node_modules                              | Удлиняет и усложняет билд образа                                                                         |
| 6   | latest версия образа node                                                                           | Могут быть проблемы с версиями и обратной совместимостью. Лучше всегда использовать фиксированную версию |

&nbsp;
&nbsp;
&nbsp;

```dockerfile
# Стадия сборки
FROM node:22 AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# Стадия продакшн
FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

&nbsp;
&nbsp;
&nbsp;
